var ThemeSetupTool=function(e){var n,i,a={activateLicense:function(t){!function t(a){var s=e("#"+htwiki_theme_setup.theme_slug+"_license_key").val();var l=e(".htwiki-license-status");o();e.ajax({url:htwiki_theme_setup.ajaxurl,type:"post",data:{action:"htwiki_activate_theme_key",wpnonce:htwiki_theme_setup.wpnonce,htwiki_license_activate:!0,htwiki_nonce:e(a).data("nonce"),key:s,attempt:i||0},beforeSend:function(t){l.addClass("active");var e=l.find("span").data("submit-message");l.find("span").text(e)},complete:function(s){"undefined"!=(s=s.responseJSON).done&&1==s.done&&"undefined"!=s.valid&&1==s.valid?(console.log("license good"),e(".htwiki-licenseinput").addClass("htwiki-licenseinput--valid"),l.find("span").text(s.message),window.location.href=a.href):(console.log("license not good"),l.find("span").text(s.message),!0===s.retry?(console.log("retrying license activation"),i=s.attempt,t(a)):(console.log("license activation failed"),e(".htwiki-licenseinput").addClass("htwiki-licenseinput--invalid")),n.done(),n=null)}})}(t)},installPlugins:function(t){(new function(){var t,n,i=0,a="",s="";function l(t){"object"==typeof t&&void 0!==t.responseJSON?(t=t.responseJSON,n.find("span").text(t.message),void 0!==t.url?t.hash==s?(n.find("span").text("failed"),u()):(s=t.hash,e.ajax({url:t.url,type:"post",data:t,complete:function(e){c(),n.find("span").text(t.message+htwiki_theme_setup.verify_text)},fail:l})):(t.done,u())):(n.find("span").text("ajax error"),u())}function c(){a&&(o(),n.find(".spinner").addClass("is-active"),e.ajax({url:htwiki_theme_setup.ajaxurl,type:"post",data:{action:"htwiki_setup_plugins",wpnonce:htwiki_theme_setup.wpnonce,slug:a},complete:l}))}function u(){var s=!1;n&&(n.data("done_item")||(i++,n.data("done_item",1)),n.find(".spinner").removeClass("is-active"));var o=e(".theme-install-setup-plugins li");o.each(function(){""===a||s?(a=e(this).data("slug"),n=e(this),c(),s=!1):e(this).data("slug")==a&&(s=!0)}),i>=o.length&&t()}return{init:function(n){e(".theme-install-setup-plugins").addClass("installing"),t=function(){o(),window.location.href=n.href},u()}}}).init(t)},installContent:function(t){(new function(){var t,n,i=0,a="",s="";function l(t){"object"==typeof t&&void 0!==t.responseJSON?(t=t.responseJSON,n.find("span").text(t.message),void 0!==t.url?t.hash==s?(n.find("span").text("failed"),c()):(s=t.hash,e.ajax({url:t.url,type:"post",data:t,complete:l})):(t.done,c())):(n.find("span").text("ajax error"),c())}function c(){var s=!1;n&&(n.data("done_item")||(i++,n.data("done_item",1)),n.find(".spinner").removeClass("is-active"));var o=e("li.htwiki-content-item");o.each(function(){""===a||s?(a=e(this).find("input:checkbox").data("content"),n=e(this),function(){if(a){var t=n.find("input:checkbox");t.is(":checked")?(console.log("processing-> "+a),n.find(".spinner").addClass("is-active"),e.ajax({url:htwiki_theme_setup.ajaxurl,type:"post",data:{action:"htwiki_setup_content",wpnonce:htwiki_theme_setup.wpnonce,add:a},complete:l})):(n.find("span").text("Skipping"),setTimeout(c,300))}}(),s=!1):e(this).find("input:checkbox").data("content")==a&&(s=!0)}),i>=o.length&&t()}return{init:function(n){e(".theme-install-setup-content").addClass("installing"),e(".theme-install-setup-content").find("input").prop("disabled",!0),t=function(){o(),window.location.href=n.href},c()}}}).init(t)}};function s(){e(".button-next").each(function(t,i){e(i).on("click",function(t){return console.log("button-next click"),!!(n=function(t){var e=jQuery(t),n=e.text(),i=e.outerWidth(),a="⡀⡀⡀⡀⡀⡀⡀⡀⡀⡀⠄⠂⠁⠁⠂⠄",s=!1;e.css("width",i),e.addClass("loading_btn_current");var o=e.is("input")||e.is("button")?"val":"text";e[o](a),e.attr("disabled",!0),e.data("done-loading","yes");var l=[0,1,2];return function t(){if(!s){for(var n="",i=0;i<l.length;i++)l[i]=l[i]+1,l[i]>=a.length&&(l[i]=0),n+=a.charAt(l[i]);e[o](n),setTimeout(function(){t()},60)}}(),{done:function(){s=!0,e[o](n),e.removeClass("loading_btn_current"),e.attr("disabled",!1)}}}(this))&&(e(this).data("callback")&&void 0!==a[e(this).data("callback")]?(o(),a[e(this).data("callback")](this),!1):(o(),!0))})}),e(".button-upload").on("click",function(t){t.preventDefault(),renderMediaUploader()}),e(".theme-presets a").on("click",function(t){t.preventDefault(),e(this).parents("ul").first().find(".current").removeClass("current"),e(this).parents("li").first().addClass("current");var n=e(this).data("style");return e("#new_style").val(n),!1}),e("input.htwiki-licenseinput__input").change(function(){!function(){var t=e(".htwiki-license-status");t.find("span").text(""),t.removeClass("active");var n=e(".htwiki-licenseinput");n.removeClass("htwiki-licenseinput--valid"),n.removeClass("htwiki-licenseinput--invalid")}()})}function o(){e(".htwiki-setupwizard__content").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}return{init:function(){t=this,e(s)},callback:function(t){console.log(t),console.log(this)}}}(jQuery);ThemeSetupTool.init();